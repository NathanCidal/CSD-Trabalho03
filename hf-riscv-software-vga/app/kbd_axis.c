#include <hf-risc.h>

#define PS2_AXI_BASE			0xe4a90000
#define PS2_AXI_STATUS			(*(volatile uint32_t *)(PS2_AXI_BASE + 0x010))
#define PS2_AXI_SDATA			(*(volatile uint32_t *)(PS2_AXI_BASE + 0x020))
#define PS2_AXI_STREADY			(1 << 0)
#define PS2_AXI_STVALID			(1 << 1)
    
uint8_t lut[256] = { 
	 //00  //01  //02  //03  //04  //05  //06  //07  //08  //09  //0A  //0B  //0C  //0D  //0E  //0F
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, '\t',  '`', 0x00,
	 //10  //11  //12  //13  //14  //15  //16  //17  //18  //19  //1A  //1B  //1C  //1D  //1E  //1F
	 0x00, 0x00, 0x00, 0x00, 0x00,  'Q',  '1', 0x00, 0x00, 0x00,  'Z',  'S',  'A',  'W',  '2', 0x00,
	 //20  //21  //22  //23  //24  //25  //26  //27  //28  //29  //2A  //2B  //2C  //2D  //2E  //2F
	 0x00,  'C',  'X',  'D',  'E',  '4',  '3', 0x00, 0x00,  ' ',  'V',  'F',  'T',  'R',  '5', 0x00,
	 //30  //31  //32  //33  //34  //35  //36  //37  //38  //39  //3A  //3B  //3C  //3D  //3E  //3F
	 0x00,  'N',  'B',  'H',  'G',  'Y',  '6', 0x00, 0x00, 0x00,  'M',  'J',  'U',  '7',  '8', 0x00,
	 //40  //41  //42  //43  //44  //45  //46  //47  //48  //49  //4A  //4B  //4C  //4D  //4E  //4F
	 0x00,  ',',  'K',  'I',  'O',  '0',  '9', 0x00, 0x00,  '.',  '/',  'L', 0x00,  'P',  '-', 0x00,
	 //50  //51  //52  //53  //54  //55  //56  //57  //58  //59  //5A  //5B  //5C  //5D  //5E  //5F
	 0x00, 0x00, 0x00, 0x00,  '[',  '=', 0x00, 0x00, 0x00, 0x00, '\n',  ']', 0x00, 0x00, 0x00, 0x00,
	 //60  //61  //62  //63  //64  //65  //66  //67  //68  //69  //6A  //6B  //6C  //6D  //6E  //6F
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, '\b', 0x00, 0x00,  '1', 0x00,  '4',  '7', 0x00, 0x00, 0x00,
	 //70  //71  //72  //73  //74  //75  //76  //77  //78  //79  //7A  //7B  //7C  //7D  //7E  //7F
	  '0',  '.',  '2',  '5',  '6',  '8', 0x00, 0x00, 0x00, 0x00,  '3',  '-',  '*',  '9', 0x00, 0x00,
	 //80  //81  //82  //83  //84  //85  //86  //87  //88  //89  //8A  //8B  //8C  //8D  //8E  //8F
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	 //90  //91  //92  //93  //94  //95  //96  //97  //98  //99  //9A  //9B  //9C  //9D  //9E  //9F
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	 //A0  //A1  //A2  //A3  //A4  //A5  //A6  //A7  //A8  //A9  //AA  //AB  //AC  //AD  //AE  //AF
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	 //B0  //B1  //B2  //B3  //B4  //B5  //B6  //B7  //B8  //B9  //BA  //BB  //BC  //BD  //BE  //BF
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	 //C0  //C1  //C2  //C3  //C4  //C5  //C6  //C7  //C8  //C9  //CA  //CB  //CC  //CD  //CE  //CF
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	 //D0  //D1  //D2  //D3  //D4  //D5  //D6  //D7  //D8  //D9  //DA  //DB  //DC  //DD  //DE  //DF
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	 //E0  //E1  //E2  //E3  //E4  //E5  //E6  //E7  //E8  //E9  //EA  //EB  //EC  //ED  //EE  //EF
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	 //F0  //F1  //F2  //F3  //F4  //F5  //F6  //F7  //F8  //F9  //FA  //FB  //FC  //FD  //FE  //FF
	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};

uint8_t char_code(uint8_t var){
	return lut[var];
}

uint8_t read_data(){
	while (!(PS2_AXI_STATUS & PS2_AXI_STVALID));
	return PS2_AXI_SDATA;
}


uint8_t ps2_axi()
{
	uint8_t data_r1;
	uint8_t data_r2;

	while(1){
		data_r1 = read_data();

		if(data_r1 >> 7 && 0x01){
			data_r2 = read_data();
			break;
		}
	}

	return char_code(data_r2);
}

int main(void){
	printf("--------------------\n");
	printf("Trabalho 02 - CSD: Nathan e Antonio - 2024\n\n");
	
	while (1) {
		uint8_t c = ps2_axi();
		printf("%c", c);

		if(c == '\b'){
			printf(" \b");
		}
	}

	return  0;
}
